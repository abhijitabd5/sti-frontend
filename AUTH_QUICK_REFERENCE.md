# Auth Session - Quick Reference\n\n## What Was Changed?\n\n### Problem\n- Users were getting logged out too frequently\n- Credentials (cookies) were not being sent with requests\n\n### Solution\n✅ **7-Day Session Duration**\n✅ **withCredentials: true** on all requests\n\n---\n\n## Key Changes\n\n### 1. AuthContext.jsx\n\n**Line 157:** Set 7-day expiration on login\n```javascript\nconst expirationTime = new Date().getTime() + (7 * 24 * 60 * 60 * 1000);\nlocalStorage.setItem('tokenExpiration', expirationTime.toString());\n```\n\n**Lines 105-109:** Check expiration on app load\n```javascript\nif (expirationTime && new Date().getTime() > parseInt(expirationTime)) {\n  clearAuthData();\n  dispatch({ type: AUTH_ACTIONS.LOGOUT });\n  return;\n}\n```\n\n### 2. httpClient.js\n\n**Line 7:** Global withCredentials\n```javascript\nwithCredentials: true,\n```\n\n**Lines 16-20:** Helper function to check expiration\n```javascript\nconst isTokenExpired = () => {\n  const expirationTime = localStorage.getItem('tokenExpiration');\n  if (!expirationTime) return false;\n  return new Date().getTime() > parseInt(expirationTime);\n};\n```\n\n**Lines 26-44:** Check before every request\n```javascript\nif (isTokenExpired()) {\n  // Clear data and redirect to login\n}\n```\n\n---\n\n## How It Works\n\n```\n1. User logs in\n   └─> Token saved + expiration set to 7 days from now\n\n2. User makes API request\n   └─> Check: Is token expired?\n       ├─ YES  → Redirect to /login\n       └─ NO   → Send request with withCredentials: true\n\n3. After 7 days\n   └─> Next request checks expiration\n       └─> Redirect to /login\n```\n\n---\n\n## Local Storage Keys\n\nAfter login, your localStorage will have:\n\n```\n{\n  \"token\": \"eyJhbGc...\",\n  \"access_token\": \"eyJhbGc...\",\n  \"refresh_token\": \"eyJhbGc...\",\n  \"user\": \"{\\\"id\\\": 1, ...}\",\n  \"tokenExpiration\": \"1730716800000\"  // ← NEW\n}\n```\n\nThe `tokenExpiration` value is:\n- A timestamp in milliseconds\n- Current time + 7 days\n- Checked before every API request\n\n---\n\n## Testing\n\n### Check if 7-day expiration was set\n```javascript\n// In browser console\nconst exp = localStorage.getItem('tokenExpiration');\nconst days = (parseInt(exp) - Date.now()) / (1000 * 60 * 60 * 24);\nconsole.log(`Token expires in ${days.toFixed(2)} days`);\n// Should output: Token expires in 7.00 days (or close to 7)\n```\n\n### Check if withCredentials is working\n```javascript\n// Open DevTools → Network tab\n// Make any API request\n// Check the request headers\n// You should see: Cookie: [your cookies]\n```\n\n### Simulate expiration (for testing)\n```javascript\n// In browser console\nlocalStorage.setItem('tokenExpiration', Date.now() - 1000);\n// Make any API request\n// Should redirect to /login automatically\n```\n\n---\n\n## If Still Having Issues\n\n### 1. Token keeps clearing frequently\n- Backend might be returning 401 (unauthorized)\n- Check backend logs for errors\n- Verify access_token is valid\n\n### 2. Cookies not being sent\n- Check if backend is setting `Access-Control-Allow-Credentials: true`\n- Verify `withCredentials: true` is in requests ✓\n- Check if cookies are HttpOnly (backend setting)\n\n### 3. Users logout after refresh\n- Confirm `tokenExpiration` is in localStorage\n- Check browser console for errors\n- Verify token verification endpoint works\n\n---\n\n## What Happens At 7 Days\n\n1. User has been logged in for 7 days\n2. User makes any API request\n3. httpClient checks: `new Date().getTime() > expirationTime`\n4. Result is TRUE → token expired\n5. All auth data cleared\n6. Browser redirects to `/login`\n7. User needs to login again\n\n---\n\n## Changed Files\n\n- ✅ `src/contexts/AuthContext.jsx` - Added expiration logic\n- ✅ `src/services/utils/httpClient.js` - Added withCredentials & expiration check\n\n---\n\n## Default Duration\n\n**Current:** 7 days\n\n### To Change Duration\n\nEdit `src/contexts/AuthContext.jsx` line 157:\n\n```javascript\n// Current: 7 days\n7 * 24 * 60 * 60 * 1000\n\n// Options:\n1 * 24 * 60 * 60 * 1000   // 1 day\n3 * 24 * 60 * 60 * 1000   // 3 days\n7 * 24 * 60 * 60 * 1000   // 7 days (current)\n14 * 24 * 60 * 60 * 1000  // 14 days\n30 * 24 * 60 * 60 * 1000  // 30 days\n```\n\n---\n\n## Flow Diagram\n\n```\n┌──────────────────┐\n│   User Logs In   │\n└────────┬─────────┘\n         │\n         ▼\n┌──────────────────────────────────┐\n│ Save tokens to localStorage      │\n│ Save user data                   │\n│ Save expiration = now + 7 days ✓ │\n└────────┬─────────────────────────┘\n         │\n         ▼\n┌──────────────────────────────┐\n│ User makes API request       │\n└────────┬─────────────────────┘\n         │\n         ▼\n     ┌───────────────────┐\n     │ Token Expired?    │\n     └────┬──────────┬───┘\n          │          │\n        YES          NO\n          │          │\n          ▼          ▼\n    ┌─────────┐  ┌──────────────┐\n    │ Logout  │  │ Send Request │\n    │ & Login │  │ + Creds: ✓   │\n    └─────────┘  └──────────────┘\n```\n\n---\n\n## Questions?\n\nRefer to: `AUTH_SESSION_SETUP.md` for detailed documentation\n"