# Promotion & Referral API (Internal)

Short reference for frontend integration of partners and posts (Phase 1).

- Base path: `/api/internal/promotion`
- Auth: JWT (Authorization: Bearer <token>)
- Roles: `super_admin`, `admin`, `marketing`
- Format: Standard responses via responseFormatter (success/error/paginated)
- System-generated fields (do not send from client):
  - `referral_code` (partners) and `post_code` (posts), generated by utils/customSlugify.generateUniqueCode

---

## Partners

### List partners
GET `/partners?search=&status=active|inactive|suspended&is_active=true|false&page=1&limit=10`

Response: paginated list of Partner objects.

### Get partner by id
GET `/partners/:id`

### Create partner
POST `/partners`

Body (JSON):
```
{
  "name": "ABC Influencer",            // required
  "mobile": "9999999999",             // required
  "email": "a@b.com",                 // optional
  "commission_rate": 10.0,             // optional
  "monthly_fee": 5000.0,               // optional
  "fee_per_post": 200.0,               // optional
  "status": "active",                 // optional: active|inactive|suspended
  "is_active": true                    // optional
}
```
Notes: `referral_code` is auto-generated and cannot be set by client.

### Update partner
PUT `/partners/:id`

Body: any of the create fields (except `referral_code`).

### Delete partner
DELETE `/partners/:id`

### Toggle partner status
PATCH `/partners/:id/toggle-status`

---

## Posts

### List posts
GET `/posts?search=&partner_id=&post_platform=facebook|youtube|instagram|tiktok|whatsapp|threads|offline|sms_campaign|other&is_active=true|false&page=1&limit=10`

Response: paginated list of Post objects.

### Get post by id
GET `/posts/:id`

### Get posts by partner
GET `/partners/:partnerId/posts?page=1&limit=10`

### Create post
POST `/posts`

Body (JSON):
```
{
  "partner_id": 1,                      // required
  "partner_name": "ABC Influencer",    // required
  "title": "EM Academy Offer",         // required
  "description": "...",                // optional
  "post_platform": "facebook",         // optional (defaults to facebook)
  "post_url": "https://fb.com/...",    // optional
  "target_url": "https://...",         // optional
  "is_active": true                     // optional
}
```
Notes: `post_code` is auto-generated and cannot be set by client.

### Update post
PUT `/posts/:id`

Body: any of the create fields (except `post_code`).

### Delete post
DELETE `/posts/:id`

### Toggle post status
PATCH `/posts/:id/toggle-status`

---

## Data Models (response shapes)

Partner object:
```
{
  "id": 1,
  "name": "ABC Influencer",
  "mobile": "9999999999",
  "email": "a@b.com",
  "referral_code": "k9x2ab1",
  "commission_rate": "10.00",
  "monthly_fee": "5000.00",
  "fee_per_post": "200.00",
  "status": "active",
  "is_active": true,
  "createdAt": "...",
  "updatedAt": "..."
}
```

Post object:
```
{
  "id": 5,
  "partner_id": 1,
  "partner_name": "ABC Influencer",
  "post_code": "q7m3p0c",
  "title": "EM Academy Offer",
  "description": "â€¦",
  "post_platform": "facebook",
  "post_url": "https://fb.com/...",
  "target_url": "https://earthmoversacademy.com/ref?...",
  "is_active": true,
  "createdAt": "...",
  "updatedAt": "..."
}
```

Paginated success response:
```
{
  "success": true,
  "message": "Data retrieved successfully",
  "data": [ /* items */ ],
  "pagination": { "page": 1, "limit": 10, "total": 42, "totalPages": 5, "hasNext": true, "hasPrev": false },
  "timestamp": "2025-11-04T12:00:00.000Z"
}
```

Validation error response:
```
{
  "success": false,
  "message": "Validation error",
  "errors": [{ "field": "name", "message": "Name is required" }],
  "timestamp": "..."
}
```

---

## Notes
- All endpoints require JWT auth and permitted roles.
- `referral_code` (partners) and `post_code` (posts) are system-generated and immutable via API.
- Use query params `page` and `limit` for pagination; defaults shown above.
- `post_platform` accepted values: facebook, youtube, instagram, tiktok, whatsapp, threads, offline, sms_campaign, other.
